"use strict";(self.webpackChunkarco_lesscode=self.webpackChunkarco_lesscode||[]).push([[878],{"./src/components/FormRender/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,b:()=>FormRender});var react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-runtime.js"),_arco_design_web_react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Button/index.js"),_arco_design_web_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Form/index.js"),_arco_design_web_react__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Space/index.js"),react__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/.pnpm/react@18.3.1/node_modules/react/index.js"),_libs_index__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./src/libs/index.ts");const{useForm}=_arco_design_web_react__WEBPACK_IMPORTED_MODULE_2__.A;function FormRender(props){const[form]=props.form?[props.form]:useForm(),[properties,setProperties]=(0,react__WEBPACK_IMPORTED_MODULE_4__.useState)({}),{maxWidth,submitText,labelCol,wrapperCol,hiddenReset,...otherProps}=props,onValuesChange=(0,react__WEBPACK_IMPORTED_MODULE_4__.useCallback)((changedValues,allValues)=>{const nextProperties=Object.entries(props.schemas.properties).reduce((acc,[key,field])=>({...acc,[key]:{...field,..."function"==typeof field.reload?field.reload(changedValues,allValues,field,form):{}}}),{});setProperties(nextProperties)},[props.schemas.properties,form]);return(0,react__WEBPACK_IMPORTED_MODULE_4__.useEffect)(()=>{setProperties(props.schemas.properties)},[props.schemas.properties]),(0,react__WEBPACK_IMPORTED_MODULE_4__.useEffect)(()=>{form.setFieldsValue(props.initialValues)},[props.initialValues,form]),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)("div",{style:{maxWidth:maxWidth||"100%",width:"100%"},children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_libs_index__WEBPACK_IMPORTED_MODULE_5__.o,{form,...otherProps,schemas:{...props.schemas,properties},onValuesChange:(value,values)=>{onValuesChange(value,values),props?.onValuesChange?.(value,values)},comments:props.comments}),(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)("div",{className:"flex justify-start",children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_arco_design_web_react__WEBPACK_IMPORTED_MODULE_2__.A.Item,{children:(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsxs)(_arco_design_web_react__WEBPACK_IMPORTED_MODULE_3__.A,{className:"flex justify-start",children:[(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_arco_design_web_react__WEBPACK_IMPORTED_MODULE_1__.A,{type:"primary",loading:props.submitting,onClick:()=>form.submit(),children:submitText||"提交"}),!hiddenReset&&(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_0__.jsx)(_arco_design_web_react__WEBPACK_IMPORTED_MODULE_1__.A,{onClick:()=>{props?.onReset?.(),form.resetFields()},children:"重置"})]})})})]})}const __WEBPACK_DEFAULT_EXPORT__=FormRender;FormRender.__docgenInfo={description:"",methods:[],displayName:"FormRender",props:{form:{required:!1,tsType:{name:"FormInstance"},description:""},maxWidth:{required:!1,tsType:{name:"string"},description:""},submitting:{required:!1,tsType:{name:"boolean"},description:""},hiddenReset:{required:!1,tsType:{name:"boolean"},description:""},submitText:{required:!1,tsType:{name:"string"},description:""},schemas:{required:!0,tsType:{name:"FormSchemas"},description:""},comments:{required:!1,tsType:{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"},description:""},initialValues:{required:!1,tsType:{name:"Record",elements:[{name:"string"},{name:"string"}],raw:"Record<string, string>"},description:""},onValuesChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(value: unknown, values: unknown) => void",signature:{arguments:[{type:{name:"unknown"},name:"value"},{type:{name:"unknown"},name:"values"}],return:{name:"void"}}},description:""},onReset:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},onSubmit:{required:!1,tsType:{name:"signature",type:"function",raw:"(values: Record<string, unknown>) => void",signature:{arguments:[{type:{name:"Record",elements:[{name:"string"},{name:"unknown"}],raw:"Record<string, unknown>"},name:"values"}],return:{name:"void"}}},description:""}},composes:["Partial"]}},"./stories/FormSubmitter.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Basic:()=>Basic,ButtonAction:()=>ButtonAction,__namedExportsOrder:()=>__namedExportsOrder,default:()=>FormSubmitter_stories});var jsx_runtime=__webpack_require__("./node_modules/.pnpm/react@18.3.1/node_modules/react/jsx-runtime.js"),react=(__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/dist/css/arco.css"),__webpack_require__("./node_modules/.pnpm/react@18.3.1/node_modules/react/index.js")),Message=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Message/index.js"),Modal=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Modal/index.js"),Space=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Space/index.js"),Button=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Button/index.js"),Result=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Result/index.js"),useDebounceFn=__webpack_require__("./node_modules/.pnpm/ahooks@3.9.0_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/ahooks/es/useDebounceFn/index.js");const FormSubmitter=({request,onFinish,hideResult,buttonMode,deleteMode,deleteTip,deleteText,params,backText,children,decideOk=()=>!0,...props})=>{const[submitting,setSubmitting]=(0,react.useState)(!1),[opened,setOpened]=(0,react.useState)(!1),[resp,setResp]=(0,react.useState)({hasCall:!1}),startRequest=(0,useDebounceFn.A)(params=>{setSubmitting(!0),request&&request(params).then(resp=>{setTimeout(()=>{setSubmitting(!1),setResp({hasCall:!0,...resp}),buttonMode&&!decideOk(resp)&&Message.A.error(resp.message),decideOk(resp)&&(onFinish&&onFinish(resp),hideResult&&Message.A.success(resp.message),deleteMode&&setOpened(!1)),decideOk(resp)||hideResult&&Message.A.warning(resp.message)},500)}).catch(err=>{console.error(err),setSubmitting(!1)})},{wait:1e3}),isOk=decideOk(resp),childrenWithProps=react.Children.map(children,child=>{if(react.isValidElement(child)){const buttonModeProps={onClick:buttonMode?()=>{deleteMode?setOpened(!0):startRequest.run(params)}:()=>{},loading:submitting?1:0},formModeProps={submitting:submitting?1:0,onReset:()=>setResp({hasCall:!1}),onSubmit:params=>{startRequest.run(params)}};return react.cloneElement(child,buttonMode?buttonModeProps:formModeProps)}return child});return hideResult||buttonMode?(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[childrenWithProps,deleteMode&&(0,jsx_runtime.jsxs)(Modal.A,{title:deleteTip||(0,jsx_runtime.jsx)("div",{className:"font-bold text-base",children:"确认执行当前操作?"}),visible:opened,footer:null,onCancel:()=>setOpened(!1),children:[deleteText,(0,jsx_runtime.jsxs)(Space.A,{children:[(0,jsx_runtime.jsx)(Button.A,{type:"primary",loading:submitting,onClick:()=>{startRequest.run(params)},children:"确定"}),(0,jsx_runtime.jsx)(Button.A,{type:"dashed",onClick:()=>setOpened(!1),children:"取消"})]})]})]}):(console.log({isOk}),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("div",{className:"flex items-center h-[100%]",style:{display:resp.hasCall?"flex":"none"},children:(0,jsx_runtime.jsx)(Result.A,{style:{width:"100%"},status:isOk?"success":"error",title:isOk?"执行成功":"提交错误",subTitle:isOk?null:resp.message,children:(0,jsx_runtime.jsxs)(Space.A,{style:{display:"flex",justifyContent:"center",width:"100%"},children:[!isOk&&(0,jsx_runtime.jsx)(Button.A,{type:"primary",onClick:()=>setResp({hasCall:!1}),children:"重试"}),isOk&&(0,jsx_runtime.jsx)(Button.A,{onClick:()=>{setResp({hasCall:!1}),props.back&&props.back()},children:backText||"返回"})]})})}),(0,jsx_runtime.jsx)("div",{style:{display:resp.hasCall?"none":"flex"},children:childrenWithProps})]}))};FormSubmitter.__docgenInfo={description:"",methods:[],displayName:"FormSubmitter",props:{hideResult:{required:!1,tsType:{name:"boolean"},description:""},buttonMode:{required:!1,tsType:{name:"boolean"},description:""},deleteMode:{required:!1,tsType:{name:"boolean"},description:""},deleteTip:{required:!1,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""},deleteText:{required:!1,tsType:{name:"union",raw:"string | React.ReactElement",elements:[{name:"string"},{name:"ReactReactElement",raw:"React.ReactElement"}]},description:""},params:{required:!1,tsType:{name:"signature",type:"object",raw:"{}",signature:{properties:[]}},description:""},backText:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"union",raw:"| React.ReactElement<Partial<FormSubmitProviderChildrenProps>>\n| React.ReactElement<Partial<FormSubmitProviderChildrenProps>>[]",elements:[{name:"ReactReactElement",raw:"React.ReactElement<Partial<FormSubmitProviderChildrenProps>>",elements:[{name:"Partial",elements:[{name:"signature",type:"object",raw:"{\n  onClick: (resp: unknown) => void;\n  onSubmit: (resp: unknown) => void;\n  onReset: (resp: unknown) => void;\n\n  submitting: boolean | number;\n  loading: boolean | number;\n}",signature:{properties:[{key:"onClick",value:{name:"signature",type:"function",raw:"(resp: unknown) => void",signature:{arguments:[{type:{name:"unknown"},name:"resp"}],return:{name:"void"}},required:!0}},{key:"onSubmit",value:{name:"signature",type:"function",raw:"(resp: unknown) => void",signature:{arguments:[{type:{name:"unknown"},name:"resp"}],return:{name:"void"}},required:!0}},{key:"onReset",value:{name:"signature",type:"function",raw:"(resp: unknown) => void",signature:{arguments:[{type:{name:"unknown"},name:"resp"}],return:{name:"void"}},required:!0}},{key:"submitting",value:{name:"union",raw:"boolean | number",elements:[{name:"boolean"},{name:"number"}],required:!0}},{key:"loading",value:{name:"union",raw:"boolean | number",elements:[{name:"boolean"},{name:"number"}],required:!0}}]}}],raw:"Partial<FormSubmitProviderChildrenProps>"}]},{name:"Array",elements:[{name:"ReactReactElement",raw:"React.ReactElement<Partial<FormSubmitProviderChildrenProps>>",elements:[{name:"Partial",elements:[{name:"signature",type:"object",raw:"{\n  onClick: (resp: unknown) => void;\n  onSubmit: (resp: unknown) => void;\n  onReset: (resp: unknown) => void;\n\n  submitting: boolean | number;\n  loading: boolean | number;\n}",signature:{properties:[{key:"onClick",value:{name:"signature",type:"function",raw:"(resp: unknown) => void",signature:{arguments:[{type:{name:"unknown"},name:"resp"}],return:{name:"void"}},required:!0}},{key:"onSubmit",value:{name:"signature",type:"function",raw:"(resp: unknown) => void",signature:{arguments:[{type:{name:"unknown"},name:"resp"}],return:{name:"void"}},required:!0}},{key:"onReset",value:{name:"signature",type:"function",raw:"(resp: unknown) => void",signature:{arguments:[{type:{name:"unknown"},name:"resp"}],return:{name:"void"}},required:!0}},{key:"submitting",value:{name:"union",raw:"boolean | number",elements:[{name:"boolean"},{name:"number"}],required:!0}},{key:"loading",value:{name:"union",raw:"boolean | number",elements:[{name:"boolean"},{name:"number"}],required:!0}}]}}],raw:"Partial<FormSubmitProviderChildrenProps>"}]}],raw:"React.ReactElement<Partial<FormSubmitProviderChildrenProps>>[]"}]},description:""},request:{required:!1,tsType:{name:"signature",type:"function",raw:"(params: unknown) => Promise<any>",signature:{arguments:[{type:{name:"unknown"},name:"params"}],return:{name:"Promise",elements:[{name:"any"}],raw:"Promise<any>"}}},description:""},onFinish:{required:!1,tsType:{name:"signature",type:"function",raw:"(resp: unknown) => void",signature:{arguments:[{type:{name:"unknown"},name:"resp"}],return:{name:"void"}}},description:""},back:{required:!1,tsType:{name:"signature",type:"function",raw:"() => void",signature:{arguments:[],return:{name:"void"}}},description:""},decideOk:{required:!1,tsType:{name:"signature",type:"function",raw:"(resp: unknown) => boolean",signature:{arguments:[{type:{name:"unknown"},name:"resp"}],return:{name:"boolean"}}},description:"",defaultValue:{value:"() => true",computed:!1}}}};var FormRender=__webpack_require__("./src/components/FormRender/index.tsx"),Typography=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Typography/index.js"),Descriptions=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Descriptions/index.js"),Alert=__webpack_require__("./node_modules/.pnpm/@arco-design+web-react@2.66.4_@types+react@19.1.10_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/@arco-design/web-react/es/Alert/index.js");const FormSubmitter_stories={title:"FormSubmitter",component:FormSubmitter,parameters:{},tags:["autodocs"],args:{},argTypes:{}},Basic={render:()=>(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(Typography.A.Title,{heading:5,style:{marginTop:0},children:"简单表单数据提交示例（IP地址查询）"}),(0,jsx_runtime.jsx)(Space.A,{}),(0,jsx_runtime.jsx)("div",{style:{paddingTop:"16px",width:"100%"},children:(0,jsx_runtime.jsx)(FormSubmitter,{request:data=>fetch(`http://ip-api.com/json/${data.ip}`).then(res=>res.json()),decideOk:resp=>"success"===resp.status,onFinish:resp=>{Modal.A.info({title:"查询成功",style:{width:"800px"},content:(0,jsx_runtime.jsx)(Descriptions.A,{border:!0,column:2,data:[...Object.entries(resp).map(([label,value])=>({label,value:`${value}`}))]})})},children:(0,jsx_runtime.jsx)(FormRender.b,{layout:"vertical",initialValues:{ip:"8.8.8.8"},schemas:{type:"object",properties:{ip:{span:12,compName:"AutoComplete"}}},comments:{ip:"ip地址"},onSubmit:values=>{console.log({values})}})})})]})},ButtonAction={render:()=>(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(Typography.A.Title,{heading:5,style:{marginTop:0},children:"简单表单数据提交示例（IP地址查询）"}),(0,jsx_runtime.jsx)(Space.A,{}),(0,jsx_runtime.jsx)("div",{style:{paddingTop:"16px",width:"100%"},children:(0,jsx_runtime.jsxs)(Space.A,{children:[(0,jsx_runtime.jsx)(FormSubmitter,{buttonMode:!0,params:{ip:"8.8.8.8"},request:data=>fetch(`http://ip-api.com/json/${data.ip}`).then(res=>res.json()),decideOk:resp=>"success"===resp.status,onFinish:resp=>{Modal.A.info({title:"查询成功",style:{width:"800px"},content:(0,jsx_runtime.jsx)(Descriptions.A,{border:!0,column:2,data:[...Object.entries(resp).map(([label,value])=>({label,value:`${value}`}))]})})},children:(0,jsx_runtime.jsx)(Button.A,{type:"primary",color:"red",children:"提交请求"})}),(0,jsx_runtime.jsx)(FormSubmitter,{buttonMode:!0,deleteMode:!0,deleteText:(0,jsx_runtime.jsx)(Alert.A,{style:{margin:"16px 0"},type:"error",content:"删除请求执行后不可恢复，确定继续执行？"}),params:{ip:"8.8.8.8"},request:data=>fetch(`http://ip-api.com/json/${data.ip}`).then(res=>res.json()),decideOk:resp=>"success"===resp.status,onFinish:resp=>{Modal.A.info({title:"操作成功",style:{width:"800px"},content:(0,jsx_runtime.jsx)(Descriptions.A,{border:!0,column:2,data:[...Object.entries(resp).map(([label,value])=>({label,value:`${value}`}))]})})},children:(0,jsx_runtime.jsx)(Button.A,{type:"secondary",status:"danger",children:"删除请求"})})]})})]})},__namedExportsOrder=["Basic","ButtonAction"];Basic.parameters={...Basic.parameters,docs:{...Basic.parameters?.docs,source:{originalSource:'{\n  render: () => {\n    return <div>\n        <Typography.Title heading={5} style={{\n        marginTop: 0\n      }}>\n          简单表单数据提交示例（IP地址查询）\n        </Typography.Title>\n        <Space></Space>\n        <div style={{\n        paddingTop: "16px",\n        width: "100%"\n      }}>\n          <FormSubmitter request={(data: any) => fetch(`http://ip-api.com/json/${data.ip}`).then(res => res.json())} decideOk={(resp: any) => resp.status === "success"} onFinish={(resp: any) => {\n          Modal.info({\n            title: "查询成功",\n            style: {\n              width: "800px"\n            },\n            content: <Descriptions border column={2} data={[...Object.entries(resp).map(([label, value]) => ({\n              label,\n              value: `${value}`\n            }))]} />\n          });\n        }}>\n            <FormRender layout="vertical" initialValues={{\n            ip: "8.8.8.8"\n          }} schemas={{\n            type: "object",\n            properties: {\n              ip: {\n                span: 12,\n                compName: "AutoComplete"\n              }\n            }\n          }} comments={{\n            ip: "ip地址"\n          }} onSubmit={values => {\n            console.log({\n              values\n            });\n          }} />\n          </FormSubmitter>\n        </div>\n      </div>;\n  }\n}',...Basic.parameters?.docs?.source}}},ButtonAction.parameters={...ButtonAction.parameters,docs:{...ButtonAction.parameters?.docs,source:{originalSource:'{\n  render: () => {\n    return <div>\n        <Typography.Title heading={5} style={{\n        marginTop: 0\n      }}>\n          简单表单数据提交示例（IP地址查询）\n        </Typography.Title>\n        <Space></Space>\n        <div style={{\n        paddingTop: "16px",\n        width: "100%"\n      }}>\n          <Space>\n            <FormSubmitter buttonMode params={{\n            ip: "8.8.8.8"\n          }} request={(data: any) => fetch(`http://ip-api.com/json/${data.ip}`).then(res => res.json())} decideOk={(resp: any) => resp.status === "success"} onFinish={(resp: any) => {\n            Modal.info({\n              title: "查询成功",\n              style: {\n                width: "800px"\n              },\n              content: <Descriptions border column={2} data={[...Object.entries(resp).map(([label, value]) => ({\n                label,\n                value: `${value}`\n              }))]} />\n            });\n          }}>\n              <Button type="primary" color="red">\n                提交请求\n              </Button>\n            </FormSubmitter>\n            <FormSubmitter buttonMode deleteMode deleteText={<Alert style={{\n            margin: "16px 0"\n          }} type="error" content="删除请求执行后不可恢复，确定继续执行？" />} params={{\n            ip: "8.8.8.8"\n          }} request={(data: any) => fetch(`http://ip-api.com/json/${data.ip}`).then(res => res.json())} decideOk={(resp: any) => resp.status === "success"} onFinish={(resp: any) => {\n            Modal.info({\n              title: "操作成功",\n              style: {\n                width: "800px"\n              },\n              content: <Descriptions border column={2} data={[...Object.entries(resp).map(([label, value]) => ({\n                label,\n                value: `${value}`\n              }))]} />\n            });\n          }}>\n              <Button type="secondary" status="danger">\n                删除请求\n              </Button>\n            </FormSubmitter>\n          </Space>\n        </div>\n      </div>;\n  }\n}',...ButtonAction.parameters?.docs?.source}}}}}]);